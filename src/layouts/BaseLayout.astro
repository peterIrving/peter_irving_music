---
// component imports
import BaseHead from "@layouts/BaseHead.astro";
import Nav from "@components/Nav/Nav.astro";
import Footer from "@components/Footer/Footer.astro";

// style import
import "@/styles/global.css";
import type { ImageMetadata } from "astro";

// heroImage and authorData are defined on blog posts
// authorData could also be defined on the about author page
interface Props {
	type?: "general";
	navStartStyle?: "default" | "dark";
	title: string;
	description: string;
	heroImage?: ImageMetadata;
	noindex?: boolean; // you need to opt-in to no indexing, as it hides the page from search engines
}

const {
	type = "general",
	navStartStyle = "default",
	title,
	description,
	heroImage,
	noindex = false,
} = Astro.props as Props;
---

<!doctype html>
<html lang="en" transition:animate="fade">
	<head>
		<BaseHead
			type={type}
			title={title}
			description={description}
			image={heroImage ? heroImage : undefined}
			noindex={noindex}
		/>
		<script
			async
			src="https://cloud.umami.is/script.js"
			data-website-id="e0965b9b-2d3b-4d00-8339-04bf810d5024"
			data-auto-track="true"
			data-domains="peterirving.live,www.peterirving.live"></script>

		<script>
			// Modified debug script that doesn't rely on window.umami
			document.addEventListener("DOMContentLoaded", () => {
				// Check if the script loaded
				const umamiScript = document.querySelector(
					'script[src="https://cloud.umami.is/script.js"]',
				);
				if (umamiScript) {
					console.log("Umami script tag is present in the DOM");
				} else {
					console.warn("Umami script tag is not found in the DOM");
				}

				// Create and send a manual pageview event
				const trackingPixel = document.createElement("img");
				const websiteId = "e0965b9b-2d3b-4d00-8339-04bf810d5024";
				const currentUrl = encodeURIComponent(window.location.href);
				const referrer = encodeURIComponent(document.referrer || "");
				const screenWidth = window.innerWidth;
				const screenHeight = window.innerHeight;

				trackingPixel.src = `https://cloud.umami.is/api/collect?website=${websiteId}&url=${currentUrl}&referrer=${referrer}&screen=${screenWidth}x${screenHeight}`;
				trackingPixel.style.display = "none";
				document.body.appendChild(trackingPixel);

				console.log("Manual tracking pixel sent to Umami");
			});
		</script>
	</head>
	<body id="body" class="bg-base-50 text-base-900">
		<div class="min-h-[100lvh]">
			<Nav startStyle={navStartStyle} />
			<main>
				<slot />
			</main>
		</div>
		<Footer />
	</body>
</html>
